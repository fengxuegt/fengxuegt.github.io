<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <!-- Website mata -->
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<!-- Disable transformation -->
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<!-- Website description -->

<meta name="description" content="汇编语言三" />


<!-- Website keywords -->

<meta name="keywords" content="汇编语言, 枫雪gt" />




<!-- Website rss -->

<link rel="alternate" href="/default" title="枫雪gt" >


<!-- Website favicon -->

<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0" />


<!-- Canonical, good for google search engine -->
<link rel="canonical" href="http://example.com/2022/01/16/汇编语言三/" />

<!-- Fancybox styling -->

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />


<!-- MathJax (LaTeX) support -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });  
  </script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


<!-- Theme styling -->
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<!-- Analytics and push -->



  



<!-- LeanCloud Counter -->


<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"latex":true};
</script>
  
  <title>汇编语言三 - 枫雪gt</title>

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div class="scrollPercentage"></div>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">枫雪gt</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
    <a href="/">
      <li class="mobile-menu-item">
        
        
        首页              </li>
    </a>
    
    <a href="/archives/">
      <li class="mobile-menu-item">
        
        
        归档              </li>
    </a>
    
    <a href="/tags/">
      <li class="mobile-menu-item">
        
        
        标签              </li>
    </a>
    
    <a href="/categories/">
      <li class="mobile-menu-item">
        
        
        分类              </li>
    </a>
    
    <a href="/about/">
      <li class="mobile-menu-item">
        
        
        关于              </li>
    </a>
    
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
      <div class="logo-wrapper">  
  <a href="/." class="logo">枫雪gt</a>  
</div>  
  
<nav class="site-navbar">  
    
    <ul id="menu" class="menu">  
        
        <li class="menu-item">  
          <a class="menu-item-link" href="/">  
              
              
              首页  
              
          </a>  
        </li>  
        
        <li class="menu-item">  
          <a class="menu-item-link" href="/archives/">  
              
              
              归档  
              
          </a>  
        </li>  
        
        <li class="menu-item">  
          <a class="menu-item-link" href="/tags/">  
              
              
              标签  
              
          </a>  
        </li>  
        
        <li class="menu-item">  
          <a class="menu-item-link" href="/categories/">  
              
              
              分类  
              
          </a>  
        </li>  
        
        <li class="menu-item">  
          <a class="menu-item-link" href="/about/">  
              
              
              关于  
              
          </a>  
        </li>  
        
    </ul>  
    
</nav>  

    </header>
    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
  <header class="post-header">
    <h1 class="post-title">
      
      汇编语言三
      
    </h1>

    <div class="post-meta">
      <span class="post-time">
        2022-01-16
      </span>
      
      
      <span class="post-category">
        
        <a href="/categories/Technology/">Technology</a>
        
      </span>
      
      
    </div>
  </header>

  
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80-%E4%B8%89"><span class="toc-number">1.</span> <span class="toc-text">汇编语言(三)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0-%E5%86%85%E4%B8%AD%E6%96%AD"><span class="toc-number">1.1.</span> <span class="toc-text">第十二章 内中断</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0-int-%E6%8C%87%E4%BB%A4"><span class="toc-number">1.2.</span> <span class="toc-text">第十三章 int 指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0-%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.3.</span> <span class="toc-text">第十四章 端口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%94%E7%AB%A0-%E5%A4%96%E4%B8%AD%E6%96%AD"><span class="toc-number">1.4.</span> <span class="toc-text">第十五章 外中断</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%85%AD%E7%AB%A0-%E7%9B%B4%E6%8E%A5%E5%AE%9A%E5%9D%80%E8%A1%A8"><span class="toc-number">1.5.</span> <span class="toc-text">第十六章 直接定址表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%83%E7%AB%A0-%E4%BD%BF%E7%94%A8BIOS%E8%BF%9B%E5%85%A5%E9%94%AE%E7%9B%98%E8%BE%93%E5%85%A5%E5%92%8C%E7%A3%81%E7%9B%98%E8%AF%BB%E5%86%99"><span class="toc-number">1.6.</span> <span class="toc-text">第十七章 使用BIOS进入键盘输入和磁盘读写</span></a></li></ol></li></ol>
    </div>
  </div>
  

  <div class="post-content">
    
    <p><strong>写在前面</strong><br>这篇博客是汇编语言（王爽）的学习笔记（三）</p>
<span id="more"></span>
<h1 id="汇编语言-三"><a href="#汇编语言-三" class="headerlink" title="汇编语言(三)"></a>汇编语言(三)</h1><h2 id="第十二章-内中断"><a href="#第十二章-内中断" class="headerlink" title="第十二章 内中断"></a>第十二章 内中断</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">**引言和简介</span><br><span class="line">    1.中断是CPU处理外部突发事件的一个重要技术</span><br><span class="line">    2.它能使CPU在运行过程中对外部事件发出的中断请求及时地进行处理，处理完成后</span><br><span class="line">        又立即返回断点，继续进行CPU原来的工作。</span><br><span class="line">    3.引起中断的原因【即：发出中断请求的来源叫作中断源】</span><br><span class="line">    4.根据中断源的不同，可以把中断分为：【软件中断】和【硬件中断】两大类</span><br><span class="line">        而硬件中断又可以分为【外部中断】和【内部中断】两类</span><br><span class="line">12.1 内中断的产生</span><br><span class="line">    1.外部中断一般是指计算机外设发出的中断请求，如：键盘中断、打印机中断、定时器中断。</span><br><span class="line">        外部中断是可以屏蔽的中断，也就是说，利用中断控制器可以屏蔽这些外部设备的中断请求。</span><br><span class="line">    2.内部中断是指因硬件出错（如突然掉电、奇偶校验错等）或运算出错（除数为零、运算溢出、单步中断）所引起的中断。</span><br><span class="line">        内部中断是不可屏蔽的中断</span><br><span class="line">    3.软件中断其实并不是真正的中断，他们只是可被调用执行的一般程序，</span><br><span class="line">        DOS的系统功能调用（int 21h）都是软件中断</span><br><span class="line">    4.CPU为了处理并发的中断请求，规定了中断的优先权，优先权由高到低的顺序是：</span><br><span class="line">        1.除法错、溢出中断、软件中断</span><br><span class="line">        2.不可屏蔽中断</span><br><span class="line">        3.可屏蔽中断</span><br><span class="line">        4.单步中断</span><br><span class="line">12.2 中断处理程序简介</span><br><span class="line">    1.CPU的设计者必须在中断信息和其处理程序的入口地址之间建立某种联系</span><br><span class="line">        使得CPU根据中断信息可以找到要执行的处理程序。</span><br><span class="line">    2.中断信息中包含有表示中断的类型码。根据CPU的设计，中断类型码的作用就是用来定位中断处理程序的。</span><br><span class="line">    3.CPU用8位的中断类型码通过中断向量表找到相应的中断处理程序的入口地址</span><br><span class="line">        即中断类型码是中断向量在中断向量表中的索引</span><br><span class="line">12.3 中断向量表【中断向量表就是中断向量的列表】</span><br><span class="line">    1.中断向量表在内存中保存，其中存放着256个【2^8,8位中断类型码】中断源所对应的中断处理程序的入口</span><br><span class="line">        对于8086PC机，中断向量表指定放在内存地址0处</span><br><span class="line">    2.从0:0-0:03ffh的1024个字节【256*4，物理地址使用段地址和偏移地址存放，需要4个字节】中存放着中断向量表</span><br><span class="line">12.4 中断过程</span><br><span class="line">    1.可以用中断类型码，在中断向量表中找到中断处理程序的入口</span><br><span class="line">        找到这个入口地址的最终目的是用它设置cs和ip，使CPU执行中断处理程序</span><br><span class="line">    2.用中断类型码找到中断向量，并用它设置cs和ip，这个工作时由CPU的硬件自动完成的</span><br><span class="line">        CPU硬件完成这个工作的过程被称为【中断过程】</span><br><span class="line">    3.中断过程</span><br><span class="line">        8086CPU的中断过程</span><br><span class="line">        1.（从中断信息中）取得中断类型码</span><br><span class="line">        2.标志寄存器的值入栈（保护标志位）</span><br><span class="line">        3.设置标志寄存器的第8位TF和第9位IF设置为0（后面讲解本步的目的）</span><br><span class="line">        4.cs内容入栈</span><br><span class="line">        5.ip内容入栈</span><br><span class="line">        6.从内存地址为中断类型码*4和中断类型码*4+2的两个子单元中</span><br><span class="line">            读取中断处理程序的入口地址设置cs和ip</span><br><span class="line">    4.使用汇编语言描述中断过程，如下</span><br><span class="line">        1.取得中断类型码N</span><br><span class="line">        2.pushf</span><br><span class="line">        3.TF=0，IF=0</span><br><span class="line">        4.push cs</span><br><span class="line">        5.push ip</span><br><span class="line">        6.（ip）=（N*4），（cs）=（N*4+2）</span><br><span class="line">12.5 中断处理程序</span><br><span class="line">    1.由于CPU随时都可能检测到中断信息，也就是说，CPU随时都可能执行中断处理程序，</span><br><span class="line">        所以，中断处理程序必须一致存储在内存某段空间中</span><br><span class="line">    2.而中断处理程序的入口地址，即【中断向量】，必须存储在对应的中断向量表表项中</span><br><span class="line">    3.中断处理程序的编写方法和子程序的比较类似，下面是常规的步骤</span><br><span class="line">        1.保存用到的寄存器</span><br><span class="line">        2.处理中断</span><br><span class="line">        3.恢复用到的寄存器</span><br><span class="line">        4.用iret指令返回</span><br><span class="line">        **iret指令的功能用汇编语法描述为</span><br><span class="line">            pop ip</span><br><span class="line">            pop cs</span><br><span class="line">            popf</span><br><span class="line">          iret通常和硬件自动完成的中断过程配合使用</span><br><span class="line">          iret指令执行后，CPU回到执行中断处理程序前的执行点继续执行程序</span><br><span class="line">12.6 除法错误中断的处理</span><br><span class="line">    当CPU执行div等除法指令的时候，如果发生了除法溢出错误，将产生中断类型码为0的终端信息</span><br><span class="line">    CPU将检测到这个信息，然后引发中断程序，转去执行0号中断对应的中断处理程序</span><br><span class="line">    例如：</span><br><span class="line">        mov ax 1000h</span><br><span class="line">        mov bh，1</span><br><span class="line">        div bh</span><br><span class="line">      此程序会产生溢出</span><br><span class="line">      运行之后，会显示</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://fengxuegt.github.io/2022/01/16/汇编语言-三/12.1.png"><img src="/Users/fengxuegt/GitHubCode/fengxuegt_blog/source/_posts/汇编语言三/12.1.png" alt="avatar"></a>avatar</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">12.7 编程处理0号中断</span><br><span class="line">    现在重新编写一个0号中断处理程序，它的功能是在屏幕中间显示“Welcome to here!”的广告词，然后返回到操作系统</span><br><span class="line">    把中断处理程序放到安全空间中</span><br><span class="line">    中断程序的框架</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://fengxuegt.github.io/2022/01/16/汇编语言-三/12.2.png"><img src="/Users/fengxuegt/GitHubCode/fengxuegt_blog/source/_posts/汇编语言三/12.2.png" alt="avatar"></a>avatar</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">12.8 安装</span><br><span class="line">    计算中断程序的长度：offset 标号1-offset 标号2</span><br><span class="line">    在代码段中存放数据        </span><br><span class="line">12.9 do0</span><br><span class="line">12.10 设置中断向量</span><br><span class="line">12.11 单步中断</span><br><span class="line">    如果检测到标志寄存器的tf位为1，则产生单步中断，引发中断过程</span><br><span class="line">12.12 响应中断的特殊情况</span><br></pre></td></tr></table></figure>
<p><img src="12.3.png" alt="avatar"></p>
<h2 id="第十三章-int-指令"><a href="#第十三章-int-指令" class="headerlink" title="第十三章 int 指令"></a>第十三章 int 指令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">13.1 int指令</span><br><span class="line">    1.int格式：int n  ;n为中断类型码</span><br><span class="line">        它的功能是引发中断过程</span><br><span class="line">    2.CPU执行int n指令，相当于引发一个n号中断的中断过程，执行过程如下</span><br><span class="line">        1.取中断类型码</span><br><span class="line">        2.标志寄存器入栈，if=0，tf=0</span><br><span class="line">        3.cs，ip入栈</span><br><span class="line">        4.从此处转去执行n号中断的中断处理过程</span><br><span class="line">    3.可以在程序中使用int指令调用任何一个中断的中断处理程序</span><br><span class="line">        可以用int指令调用这些子程序，也可以自己编写一些中断处理程序供别人使用</span><br><span class="line">13.2 编写供应用程序调用的中断例程</span><br><span class="line">    【实例1】编写、安装中断7ch的中断例程，实现求一个word型数据的平方</span><br><span class="line">        1.功能：求一word型数据的平方</span><br><span class="line">        2.参数：（ax）=要计算的数据</span><br><span class="line">        3.返回值：dx、ax中存放结果的高16位和低16位</span><br><span class="line">        4.应用举例：求2*3456^2</span><br><span class="line">;程序1：调用中断程序计算平方</span><br><span class="line">code segment</span><br><span class="line">    assume cs: code</span><br><span class="line">start:</span><br><span class="line">    mov ax,3456; (ax)=3456</span><br><span class="line">    int 7ch;调用中断7ch的中断例程，计算ax中的数据的平方</span><br><span class="line">    </span><br><span class="line">    add ax,ax</span><br><span class="line">    adc dx,dx ;存放结果，讲结果乘以2</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line"></span><br><span class="line">;程序2：编写中断程序</span><br><span class="line">;程序2中要做三部分工作</span><br><span class="line">;   1.编程实现求平方功能的程序</span><br><span class="line">;   2.安装程序，我们将其安装在0:200处</span><br><span class="line">;   3.设置中断向量表，将程序的入口地址保存在7ch表项中，使其成为中断7ch的中断例程。</span><br><span class="line">code segment</span><br><span class="line">    assume cs:code</span><br><span class="line">start:</span><br><span class="line">    mov ax,cs</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov si,offset sqr					;设置ds:si指向源地址</span><br><span class="line">    mov ax,0</span><br><span class="line">    mov es,ax</span><br><span class="line">    mov di,200h							;设置es:di指向目的地址</span><br><span class="line">    mov cx,offset sqrend - offset sqr	;设置cx为传输长度</span><br><span class="line">    cld									;设置传输方向为正</span><br><span class="line">    rep movsb</span><br><span class="line"></span><br><span class="line">    mov ax,0</span><br><span class="line">    mov es,ax</span><br><span class="line">    mov word ptr es:[7ch*4],200h        ;设置中断向量地址，偏移地址</span><br><span class="line">    mov word ptr es:[7ch*4+2],0         ;设置中断向量地址，段地址</span><br><span class="line"></span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">  sqr:  </span><br><span class="line">		mul ax</span><br><span class="line">		iret</span><br><span class="line">sqrend:	nop</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line">【实例2】编写、安装中断7ch的中断例程，实现将一个全是字母，以0结尾的字符串，转化为大写。</span><br><span class="line">code segment</span><br><span class="line">    assume cs:code</span><br><span class="line">start:</span><br><span class="line">    mov ax,cs</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov si,offset capital</span><br><span class="line">    mov ax,0</span><br><span class="line">    mov es,ax</span><br><span class="line">    mov di,200h</span><br><span class="line">    mov cx,offset capitalend - offset capital</span><br><span class="line">    cld</span><br><span class="line">    rep movsb</span><br><span class="line"></span><br><span class="line">    mov ax,0</span><br><span class="line">    mov es,ax</span><br><span class="line">    mov word ptr es:[7ch*4],200h</span><br><span class="line">    mov word ptr es:[7ch*4+2],0</span><br><span class="line"></span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">capital:</span><br><span class="line">    push cx</span><br><span class="line">    push si</span><br><span class="line">		</span><br><span class="line">change: </span><br><span class="line">    mov cl,[si]</span><br><span class="line">    mov ch,0</span><br><span class="line">    jcxz ok</span><br><span class="line">    and byte ptr [si],11011111b</span><br><span class="line">    inc si</span><br><span class="line">    jmp short change</span><br><span class="line">ok:	</span><br><span class="line">    pop si</span><br><span class="line">    pop cx</span><br><span class="line">    iret</span><br><span class="line">		</span><br><span class="line">capitalend:</span><br><span class="line">    nop</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line">13.3 对int、iret和栈的深入理解</span><br><span class="line">    【问题】用7ch中断例程完成loop指令的功能</span><br><span class="line">        不要随便修改sp，可以使用bp进行间接访问</span><br><span class="line">13.4 BIOS和DOS所提供的中断例程</span><br><span class="line">13.5 BIOS和DOS中断例程的安装过程</span><br><span class="line">    1.开机后，CPU一加电，初始化（cs）=0ffffh，ip=0，自动从ffff:0单元开始执行程序</span><br><span class="line">        ffff:0处有一条跳转指令，CPU执行该指令后，转去执行bios中的硬件系统的检测和初始化程序。</span><br><span class="line">    2.初始化程序将建立bios所支持的中断向量，即将bios提供的中断例程的入口地址登记在中断向量表中。</span><br><span class="line">    3.硬件系统检测和初始化完成后，调用19h进行操作系统的引导。从此将计算机交由操作系统控制。</span><br><span class="line">    4.DOS启动后，除完成其他工作外，还将它所提供的中断例程装入内存，并建立相应的中断向量</span><br><span class="line">13.6 BIOS中断例程的应用</span><br><span class="line">    1.int 10h中断例程是bios提供的中断例程，其中包含了多个和屏幕输出相关的子程序</span><br><span class="line">        一般来说，一个供程序员调用的中断例程中，往往包括多个子程序，中断例程内部用传递进来的参数来决定执行哪个子程序</span><br><span class="line">    2.bios和dos提供的中断例程，都用ah来传递内部子程序的编号</span><br><span class="line">13.7 DOS中断例程应用</span><br><span class="line">    int 21h中断例程是dos提供的中断例程，其中包含了dos提供给程序员造编程时调用的子程序</span><br><span class="line">    【实验13】</span><br><span class="line">**介绍一本汇编语言的书《The Art of Assembly Language》</span><br></pre></td></tr></table></figure>
<h2 id="第十四章-端口"><a href="#第十四章-端口" class="headerlink" title="第十四章 端口"></a>第十四章 端口</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">CPU可以直接读写3个地方的数据</span><br><span class="line">    1.CPU内部的寄存器</span><br><span class="line">    2.内存单元</span><br><span class="line">    3.端口</span><br><span class="line">14.1 端口的读写</span><br><span class="line">    1.对端口的读写不能用mov、push、pop等内存读写指令</span><br><span class="line">        端口的读写指令只有两条：【in】和【out】分别用于从端口读取数据和往端口写入数据</span><br><span class="line">    2.CPU执行内存访问指令和端口访问指令时，总线上的信息：</span><br><span class="line">        1.访问内存</span><br><span class="line">            mov ax,ds:[8];</span><br><span class="line">            假设执行前（ds）=0</span><br><span class="line">            执行时，与总线相关的操作：</span><br><span class="line">            1.CPU通过地址线将地址信息8发出</span><br><span class="line">            2.CPU通过控制线发出内存读命令，选中存储器芯片，并通知它，将要从中读取数据</span><br><span class="line">            3.存储器将8号单元中的数据通过数据线送入CPU</span><br><span class="line">        2.访问端口</span><br><span class="line">            这里的【端口】是对硬件开放的端口</span><br><span class="line">            in al,60h; 从60h号端口读入一个字节</span><br><span class="line">            执行时与总线相关的操作</span><br><span class="line">            1.CPU通过地址线将地址信息60h发出</span><br><span class="line">            2.CPU通过控制线发出端口读命令，选中端口所在的芯片，并通知它，将要从中读取数据</span><br><span class="line">            3.端口所在的芯片将60h端口中的数据通过数据线送入CPU</span><br><span class="line">            **注意：在in和out指令中，只能使用ax或al来存放从端口中读入的数据或要发送到端口中的数据</span><br><span class="line">                访问8位端口时用al，访问16位端口时用ax</span><br><span class="line">        3.对0-255以内的端口进行读写</span><br><span class="line">            in al,20h       ;从20h端口读一个字节</span><br><span class="line">            out 20h,al      ;往20h端口写一个字节</span><br><span class="line">        4.对256-65535的端口进行读写时，端口号放在【dx】中</span><br><span class="line">            mov dx,3f8h     ;将端口号3f8送入dx</span><br><span class="line">            in al,dx        ;从3f8h端口读一个字节</span><br><span class="line">            out dx,al        ;从3f8h端口写一个字节</span><br><span class="line">14.2 CMOS RAM芯片</span><br><span class="line">    1.PC机中有一个CMOS RAM芯片，其有如下特征</span><br><span class="line">        1.包含一个实时钟和一个有128个存储单元的RAM存储器。（早期的计算机为64字节）</span><br><span class="line">        2.该芯片靠电池供电。因此，关机后其内部的实时钟仍可以正常工作，RAM中的信息不丢失</span><br><span class="line">        3.128字节的RAM中，内部实时钟占用0-0dh单元来保存时间信息，其余大部分分单元用于</span><br><span class="line">            保存系统配置信息，供系统启动时bios程序读取</span><br><span class="line">            bios也提供了相关的程序，使我们可以在开机的时候配置CMOS RAM中的系统信息</span><br><span class="line">        **补充：BIOS</span><br><span class="line">            BIOS是英文&quot;Basic Input Output System&quot;的缩略词，直译过来后中文名称就是&quot;基本输入输出系统&quot;。</span><br><span class="line">              在IBM PC兼容系统上，是一种业界标准的固件接口。BIOS这个字眼是在1975年第一次由CP/M操作系统中出现。</span><br><span class="line">              BIOS是个人电脑启动时加载的第一个软件</span><br><span class="line">        4.该芯片内部有两个端口，端口地址为70h和71h。CPU通过这两个端口读写CMOS RAM。</span><br><span class="line">        5.70h为地址端口，存放要访问的CMOS RAM单元的地址；71h为数据端口，存放从选定的CMOS RAM单元中读取的数据</span><br><span class="line">            或要写入到其中的数据</span><br><span class="line">    2.比如：读CMOS RAM的2号单元：</span><br><span class="line">        1.将2送入端口70h</span><br><span class="line">        2.从71h读取2号单元的内容</span><br><span class="line">14.3 shl和shr指令</span><br><span class="line">    shl和shr是逻辑移位指令，后面的课程中我们要用到移位指令</span><br><span class="line">    1.shl逻辑左移指令，功能为：</span><br><span class="line">        1.将一个寄存器或内存单元中的数据向左移位</span><br><span class="line">        2.将最后移出的移位写入cf中</span><br><span class="line">        3.最低位用0补充</span><br><span class="line">        例如有如下指令：</span><br><span class="line">            mov al,01001000b</span><br><span class="line">            shl al,1        ;将al中的数据左移一位</span><br><span class="line">            执行后(al)=100100000b，cf=0.</span><br><span class="line">        如果移动位数大于1时，必须将移动位数放在cl中</span><br><span class="line">    2.shr逻辑右移指令，与shl刚好相反</span><br><span class="line">14.4 CMOS RAM中存储的时间信息</span><br><span class="line">    在CMOS RAM中存放着当前时间</span><br><span class="line">      秒：00h</span><br><span class="line">      分：02h</span><br><span class="line">      时：04h</span><br><span class="line">      日：07h</span><br><span class="line">      月：08h</span><br><span class="line">      年：09h</span><br><span class="line">    这6个信息的长度都为1个字节</span><br><span class="line">    这些数据以BCD码的方式存放，一个字节可以表示两个BCD码</span><br><span class="line">    CMOS RAM存储时间信息的单元中存储了用两个BCD码表示的两个十进制数</span><br><span class="line">        高4位的BCD码表示十位，低四位的BCD码表示个位</span><br><span class="line">    【编程】：在屏幕中间显示当前的月份</span><br><span class="line">        1.CMOS RAM芯片回顾：</span><br><span class="line">            1.70h为地址端口，存放要访问的CMOS RAM单元的地址</span><br><span class="line">            2.71h为数据端口，存放从选定的CMOS RAM单元中【读取】的数据，或【写入】其中的数据</span><br><span class="line">        2.分析</span><br><span class="line">          这个程序主要做两部分工作</span><br><span class="line">            1.从CMOS RAM的8号单元读取当前月份的BCD码</span><br><span class="line">                要读取CMOS RAM的信息，我们首先要向地址端口70h写入要访问的单元的地址</span><br><span class="line">                mov al,8</span><br><span class="line">                out 70h,al</span><br><span class="line">                然后从数据端口71h中取得指定单元中的数据</span><br><span class="line">                in al,71h</span><br><span class="line">            2.将用BCD码表示的月份以十进制的形式显示到屏幕上</span><br><span class="line">;编程：在屏幕中间显示当前的月份</span><br><span class="line">code segment</span><br><span class="line">    assume cs:code</span><br><span class="line">start:</span><br><span class="line">    mov	al,8</span><br><span class="line">    out 70h,al</span><br><span class="line">    in	al,71h</span><br><span class="line">    mov ah,al</span><br><span class="line">    mov cl,4</span><br><span class="line">    shr ah,cl</span><br><span class="line">    and al,00001111b</span><br><span class="line"></span><br><span class="line">    add ah,30h</span><br><span class="line">    add al,30h</span><br><span class="line"></span><br><span class="line">    mov bx,0b800h	;显存</span><br><span class="line">    mov es,bx</span><br><span class="line">    mov byte ptr es:[160*12+40*2],ah     ;显示月份的十位数码</span><br><span class="line">    mov byte ptr es:[160*12+40*2+2],al   ;显示月份的个位数码</span><br><span class="line"></span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line">【实验十四】编程：以“年/月/日 时:分:秒”的格式，显示当前日期和时间</span><br></pre></td></tr></table></figure>
<h2 id="第十五章-外中断"><a href="#第十五章-外中断" class="headerlink" title="第十五章 外中断"></a>第十五章 外中断</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">**CPU除了有运算能力，还有I/O能力</span><br><span class="line">15.1 接口芯片和端口</span><br><span class="line">    1.在PC系统的接口卡和主板上，装有各种接口芯片，这些外设接口芯片的内部装有若干寄存器</span><br><span class="line">        CPU将这些寄存器当做【端口】访问</span><br><span class="line">    2.外设的输入不直接送入内存和CPU，而是送入相关的接口芯片的【端口】中</span><br><span class="line">    3.CPU向外设的输出也是要先送入【端口】中，再由相关芯片送入到外设</span><br><span class="line">    4.CPU可以向外设输出控制命令，这些控制命令也是先送到【端口】中，然后相关芯片根据命令进行相关工作</span><br><span class="line">    5.可见：CPU与外部设备的交流是通过【端口】进行的</span><br><span class="line">        CPU在执行完当前指令后，可以检测到发送过来的中断信息，引发中断过程，处理外设的输入  </span><br><span class="line">15.2 外中断信息</span><br><span class="line">    1.在PC系统中，外中断源一共有两类</span><br><span class="line">        1.可屏蔽中断</span><br><span class="line">        2.不可屏蔽中断</span><br><span class="line">    2.可屏蔽中断是CPU可以不响应的外中断。CPU是否响应可屏蔽中断</span><br><span class="line">        要看标志寄存器的IF位的设置</span><br><span class="line">        当CPU检测到可屏蔽中断信息时：</span><br><span class="line">        1.若IF=1，则CPU在执行完当前指令后相应中断，引发中断过程</span><br><span class="line">        2.若IF=0，则不响应可屏蔽中断</span><br><span class="line">    3.可屏蔽中断所引发的中断过程，除在第一步的实现上与内中断有所不同外，基本上和内中断的中断过程相同</span><br><span class="line">    4.因为可屏蔽中断信息来自于CPU外部，中断类型码是通过数据总线送入CPU的</span><br><span class="line">        而内中断的中断码是在CPU内部产生的</span><br><span class="line">    5.IF设置为0的原因：在进入中断处理程序后，禁止其他的可屏蔽中断</span><br><span class="line">        当然，如果中断处理程序中需要处理可屏蔽中断，可以用指令将IF设置为1</span><br><span class="line">    6.8086CPU提供的设置IF的指令如下：</span><br><span class="line">        sti         ;用于设置IF=1</span><br><span class="line">        cli         ;用于设置IF=0</span><br><span class="line">    7.不可屏蔽中断是CPU必须相应的外中断。</span><br><span class="line">        当CPU检测到不可屏蔽中断信息时，则在执行完当前指令后</span><br><span class="line">        立即响应，应发中断过程</span><br><span class="line">    8.8086CPU不可屏蔽中断的中断类型码固定为2，所以中断过程中，不需要取中断类型码</span><br><span class="line">    9.不可屏蔽中断的中断过程</span><br><span class="line">        1.标志寄存器入栈，IF=0，TF=0</span><br><span class="line">        2.CS，IP入栈</span><br><span class="line">        3.（IP）=（8），（CS）=（0AH）   ;固定地址</span><br><span class="line">    10.几乎所有外中断，都是可屏蔽中断。当外设有需要处理的事件发生时</span><br><span class="line">        相关芯片向CPU发出可屏蔽中断信息。</span><br><span class="line">        不可屏蔽中断是系统中有必须处理的紧急情况发生时用来通知CPU的中断信息，本门课程中，主要讨论可屏蔽中断</span><br><span class="line">15.3 PC机键盘的处理过程</span><br><span class="line">    1.下面看一个键盘输入的处理过程，并以此来体会PC机处理外设输入的基本方法</span><br><span class="line">        1.键盘输入</span><br><span class="line">        2.引发9号中断</span><br><span class="line">        3.执行int 9中断例程</span><br><span class="line">    2.PC机键盘的处理过程</span><br><span class="line">        1.键盘上每一个键相当于一个开关，键盘中有一个芯片对键盘上的每一触键的开关状态进行扫描。</span><br><span class="line">        2.按下一个键时，开关接通，该芯片就产生一个扫描码，扫描码说明按下的键在键盘上的位置</span><br><span class="line">            扫描码被送入主板上的相关接口芯片的寄存器中，该寄存器的端口地址为60H</span><br><span class="line">        3.松开控下的键时，也产生一个扫描码，扫描码说明了松开的键在键盘上的位置，松开按键时</span><br><span class="line">            产生的扫描码也被送入60H端口中。</span><br><span class="line">          一般按下一个键时，产生的扫描码称为通码，松开一个键产生的扫描码称为断码</span><br><span class="line">          扫描码长度为一个字节，通码的第七位为0，断码的第七位为1</span><br><span class="line">            即：断码=通码+80H</span><br><span class="line">          **BIOS提供了int9中断例程，用来进行基本的键盘输入处理，主要的工作如下：</span><br><span class="line">            1.读出60H端口中的扫描码</span><br><span class="line">            2.如果是字符键的扫描码，将该扫描码对应的字符码（即：ASCII码）送入内存中的BIOS键盘缓冲区</span><br><span class="line">            3，如果是控制键和切换键的扫描码，则将其转变为状态字节，写入内存中存储状态字节的单元</span><br><span class="line">        4.键盘的输入到达60H端口时，相关的芯片会向CPU发出中断类型码为9的可屏蔽中断信息。</span><br><span class="line">        5.CPU检测到中断信息后，如果IF=1，则相应中断，同时将IF设置为0（不让其他可屏蔽中断进行干扰），引发中断过程，转去执行int9中断例程</span><br><span class="line">    3.BIOS键盘缓冲区是系统启动后，BIOS用于存放int9中断例程所接受的键盘输入的内存区</span><br><span class="line">    4.该内存区可以存储15个键盘输入，int9中断例程除了接收扫描码外，还要产生和扫描码对应的字符码，</span><br><span class="line">        所以在BIOS键盘缓冲区中，一个键盘输入用一个字单元存放，高字节存放扫描码，低字节存放字符码</span><br><span class="line">    5.0040:17单元存储键盘状态字节，该字节记录了控制键和切换键的状态。键盘状态字节各位记录的信息如下：</span><br></pre></td></tr></table></figure>
<p><img src="15.1.png" alt="avatar"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">15.4 编写int9中断例程,并安装</span><br><span class="line">    梳理键盘输入的处理过程</span><br><span class="line">        1.键盘产生扫描码</span><br><span class="line">        2.扫描码送入60H端口</span><br><span class="line">        3.一旦侦测到60H端口有动静，引发9号中断</span><br><span class="line">        4.CPU执行int9中断例程处理输入</span><br><span class="line">      以上的过程，前三步都由硬件系统自动完成，能够修改的只有第四步，修改int9中断程序</span><br><span class="line">    【任务演示】在屏幕中依次显示“a”~“z”并可以让人看清。在显示过程中，按下Esc键后，该表显示的颜色</span><br><span class="line">;程序1：实现连续显示“a”~“z”</span><br><span class="line">;编程：在屏幕中间依次显示“a”~“z”，并可以让人看清。在显示的过程中，按下&#x27;Esc&#x27;键后，改变显示的颜色。</span><br><span class="line">;部分功能代码：</span><br><span class="line">stack segment</span><br><span class="line">	db 128 dup (0)</span><br><span class="line">stack ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">    assume cs:code</span><br><span class="line">start:  </span><br><span class="line">	mov ax,stack</span><br><span class="line">	mov ss,ax</span><br><span class="line">	mov sp,128</span><br><span class="line"></span><br><span class="line">	mov ax,0b800h</span><br><span class="line">    mov es,ax</span><br><span class="line">    mov ah,&#x27;a&#x27;</span><br><span class="line">s:	mov es:[160*12+40*2],ah</span><br><span class="line">	call delay</span><br><span class="line">	inc ah</span><br><span class="line">	cmp ah,&#x27;z&#x27;</span><br><span class="line">	jna s</span><br><span class="line"></span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">delay:	</span><br><span class="line">	push ax</span><br><span class="line">	push dx</span><br><span class="line">	mov dx,0010h	;循环10000000h次</span><br><span class="line">	mov ax,0</span><br><span class="line">s1:	                   </span><br><span class="line">	sub ax,1</span><br><span class="line">	sbb dx,0</span><br><span class="line">	cmp ax,0</span><br><span class="line">	jne s1</span><br><span class="line">	cmp dx,0</span><br><span class="line">	jne s1</span><br><span class="line">	pop dx</span><br><span class="line">	pop ax</span><br><span class="line">	ret</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start </span><br><span class="line"></span><br><span class="line">;程序2：实现改变颜色</span><br><span class="line">;编程：在屏幕中间依次显示“a”~“z”，并可以让人看清。在显示的过程中，按下&#x27;Esc&#x27;键后，改变显示的颜色。</span><br><span class="line">stack segment</span><br><span class="line">	db 128 dup (0)</span><br><span class="line">stack ends</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">	dw 0,0</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">    assume cs:code</span><br><span class="line">start:	</span><br><span class="line">	mov ax,stack</span><br><span class="line">	mov ss,ax</span><br><span class="line">	mov sp,128</span><br><span class="line">	mov ax,data</span><br><span class="line">	mov ds,ax</span><br><span class="line">	mov ax,0</span><br><span class="line">	mov es,ax</span><br><span class="line"></span><br><span class="line">	push es:[9*4]</span><br><span class="line">	pop ds:[0]</span><br><span class="line">	push es:[9*4+2]</span><br><span class="line">	pop ds:[2]			;将原来的int 9中断例程的入口地址保存在ds:0、ds:2单元中</span><br><span class="line"></span><br><span class="line">	mov word ptr es:[9*4],offset int9</span><br><span class="line">	mov es:[9*4+2],cs	;在中断向量表中设置新的int 9中断例程的入口地址</span><br><span class="line"></span><br><span class="line">	mov ax,0b800h</span><br><span class="line">	mov es,ax</span><br><span class="line">	mov ah,&#x27;a&#x27;</span><br><span class="line">s:	</span><br><span class="line">	mov  es:[160*12+40*2],ah</span><br><span class="line">	call delay</span><br><span class="line">	inc ah</span><br><span class="line">	cmp ah,&#x27;z&#x27;</span><br><span class="line">	jna s</span><br><span class="line">	mov ax,0</span><br><span class="line">	mov es,ax</span><br><span class="line"></span><br><span class="line">	push ds:[0]</span><br><span class="line">	pop es:[9*4]</span><br><span class="line">	push ds;[2]</span><br><span class="line">	pop es;[9*4+2]   	;将中断向量表中int 9中断例程的入口恢复为原来的地址</span><br><span class="line"></span><br><span class="line">	mov ax,4c00h</span><br><span class="line">	int 21h</span><br><span class="line"></span><br><span class="line">delay:	</span><br><span class="line">	push ax</span><br><span class="line">	push dx</span><br><span class="line">	mov dx,0010h</span><br><span class="line">	mov ax,0</span><br><span class="line">s1: 	</span><br><span class="line">	sub ax,1</span><br><span class="line">	sbb dx,0</span><br><span class="line">	cmp ax,0</span><br><span class="line">	jne s1</span><br><span class="line">	cmp dx,0</span><br><span class="line">	jne s1</span><br><span class="line">	pop dx</span><br><span class="line">	pop ax</span><br><span class="line">	ret</span><br><span class="line"></span><br><span class="line">;------以下为新的int 9中断例程--------------------</span><br><span class="line">;int9中断例程是在进行键盘输入之后，由系统自动调用</span><br><span class="line">int9:	</span><br><span class="line">	push ax</span><br><span class="line">	push bx</span><br><span class="line">	push es</span><br><span class="line"></span><br><span class="line">	in al,60h</span><br><span class="line"></span><br><span class="line">	pushf</span><br><span class="line">	pushf</span><br><span class="line">	pop bx</span><br><span class="line">	and bh,11111100b</span><br><span class="line">	push bx</span><br><span class="line">	popf</span><br><span class="line">	call dword ptr ds:[0] 				;对int指令进行模拟，调用原来的int 9中断例程</span><br><span class="line"></span><br><span class="line">	cmp al,1</span><br><span class="line">	jne int9ret</span><br><span class="line"></span><br><span class="line">	mov ax,0b800h</span><br><span class="line">	mov es,ax</span><br><span class="line">	inc byte ptr es:[160*12+40*2+1]  	;属性增加1，改变颜色</span><br><span class="line"></span><br><span class="line">int9ret:</span><br><span class="line">	pop es</span><br><span class="line">	pop bx</span><br><span class="line">	pop ax</span><br><span class="line">	iret</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<h2 id="第十六章-直接定址表"><a href="#第十六章-直接定址表" class="headerlink" title="第十六章 直接定址表"></a>第十六章 直接定址表</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br></pre></td><td class="code"><pre><span class="line">16.1 描述了单元长度的标号</span><br><span class="line">    1.本章讨论如何有效合理地组织数据，以及相关的编程技术</span><br><span class="line">        1.前面的课程中，我们一直在代码段中使用标号来标记指令、数据、段的起始地址</span><br><span class="line">        2.还可以使用一种标号，这种标号不但可以表示内存单元的地址，还表示了内存单元的长度</span><br><span class="line">            即：表示在此标号处的单元，是一个字节单元，还是字单元还是双字单元</span><br><span class="line">    2.例如</span><br><span class="line">        1.标号1</span><br><span class="line">        a : db 1,2,3,4,5,6,7,8</span><br><span class="line">        b : dw 0</span><br><span class="line">      此种标号只能标记地址</span><br><span class="line">      此种加有“:”的地址标号，只能在代码段中使用，不能在其他段中使用</span><br><span class="line">        2.标号2</span><br><span class="line">        a db 1,2,3,4,5,6,7,8    ;标号a，描述了地址code:0,和从这个地址开始，以后的内存单元都是字节单元</span><br><span class="line">        b dw 0                  ;标号b描述了地址code:8，和从这个地址开始，以后的内存单元都是字单元</span><br><span class="line">      此种标号既可以标记地址，也可以表示此标号处的单元</span><br><span class="line">    3.使用这种包含单元长度的标号，可以使我们以简洁的形式访问内存中的数据</span><br><span class="line">      这种标号此后称为数据标号，它标记了存储数据的单元的地址和长度</span><br><span class="line">    4.数据标号的用法</span><br><span class="line">        指令：mov ax,b             ;相当于：mov ax,cs:[8]</span><br><span class="line">        指令：mov b,2              ;相当于：mov word ptr cs:[8],2</span><br><span class="line">        指令：inc b                ;相当于：inc word ptr cs:[8]</span><br><span class="line">        指令：mov al,a [si]        ;相当于：mov al,cs:0[si]</span><br><span class="line">        指令：mov al,a[3]          ;相当于：mov al,cs:0[3]</span><br><span class="line">        指令：mov al,a[bx+si+3]    ;相当于：mov al,cs:0[bx+si+3]</span><br><span class="line">16.2 在其他段中使用数据标号</span><br><span class="line">    1.注意，如果想在代码段中，直接用数据标号访问数据，</span><br><span class="line">        则需要用伪指令assume 将标号所在的段和一个段寄存器联系起来。</span><br><span class="line">      否则编译器在编译的时候，无法确定标号的段地址在哪一个寄存器中。</span><br><span class="line">    2. 当然，这种联系是编译器需要的，但绝对不是说，我们因为编译器的工作需要，</span><br><span class="line">        用assume指令将段寄存器和某个段相联系，段寄存器中就会真的存放该段的地址。</span><br><span class="line">    3.我们可以将数据标号当作数据来定义，此时，编译器将标号所表示的地址当作数据的值。 </span><br><span class="line">      1.把数据标号当做数据来定义时，使用【dw】定义数据</span><br><span class="line">      比如：     data segment</span><br><span class="line">              		a db 1,2,3,4,5,6,7,8</span><br><span class="line">      			  	b dw 0</span><br><span class="line">                    c dw a,b        ;数据标号c处存储的两个字型数据为标号a、b 的偏移地址。</span><br><span class="line">      			 data ends</span><br><span class="line">      数据标号c处存储的两个字型数据为标号a、b 的偏移地址。</span><br><span class="line">      相当于：</span><br><span class="line">                data segment</span><br><span class="line">                    a db 1,2,3,4,5,6,7,8</span><br><span class="line">                    b dw 0</span><br><span class="line">                    c dw offset a, offset b</span><br><span class="line">                 data ends</span><br><span class="line">      2.把数据标号当做数据来定义时，使用【dd】定义数据</span><br><span class="line">        再比如：</span><br><span class="line">            data segment</span><br><span class="line">                a db 1,2,3,4,5,6,7,8</span><br><span class="line">                b dw 0</span><br><span class="line">                c dd a,b    ;数据标号c处存储的两个双字型数据为标号a的偏移地址和段地址、标号b 的偏移地址和段地址。</span><br><span class="line">             data ends</span><br><span class="line">        数据标号c处存储的两个双字型数据为标号a的偏移地址和段地址、标号b 的偏移地址和段地址。</span><br><span class="line">        相当于：</span><br><span class="line">            data segment</span><br><span class="line">                    a db 1,2,3,4,5,6,7,8</span><br><span class="line">                    b dw 0</span><br><span class="line">                    c dw offset a, seg a, offset b, seg b   ;seg操作符，功能为取得某一标号的段地址。</span><br><span class="line">                 data ends</span><br><span class="line">            seg操作符，功能为取得某一标号的段地址。</span><br><span class="line">16.3 直接定址表</span><br><span class="line">    本节课，我们将使用“查表”的方法，编写相关程序的技巧</span><br><span class="line">    【任务】编写子程序，以十六进制的形式在屏幕中间显示给定的byte型数据</span><br><span class="line">code segment</span><br><span class="line">    assume cs:code</span><br><span class="line">start:  </span><br><span class="line">		mov al,0eh          ;al中存放了byte型数据</span><br><span class="line"></span><br><span class="line">        call showbyte</span><br><span class="line"></span><br><span class="line">        mov ax,4c00h</span><br><span class="line">        int 21h</span><br><span class="line"></span><br><span class="line">;子程序：</span><br><span class="line">;用al传送要显示的数据</span><br><span class="line"></span><br><span class="line">showbyte:</span><br><span class="line">        jmp short show</span><br><span class="line"></span><br><span class="line">        table db &#x27;0123456789ABCDEF&#x27;	;字符表</span><br><span class="line"></span><br><span class="line">show:   push bx                 ;保护现场</span><br><span class="line">        push es</span><br><span class="line"></span><br><span class="line">        mov ah,al</span><br><span class="line">        shr ah,1           </span><br><span class="line">        shr ah,1</span><br><span class="line">        shr ah,1</span><br><span class="line">        shr ah,1			    ;右移4位，ah中得到高4位的值</span><br><span class="line">        and al,00001111b		;al中为低4位的值</span><br><span class="line"></span><br><span class="line">        mov bl,ah</span><br><span class="line">        mov bh,0</span><br><span class="line">        mov ah,table[bx]		;用高4位的值作为相对于table的偏移，取得对应的字符</span><br><span class="line"></span><br><span class="line">        mov bx,0b800h</span><br><span class="line">        mov es,bx</span><br><span class="line">        mov es:[160*12+40*2],ah</span><br><span class="line"></span><br><span class="line">        mov bl,al</span><br><span class="line">        mov bh,0</span><br><span class="line">        mov al,table[bx]		;用低4位的值作为相对于table的偏移，取得对应的字符</span><br><span class="line">        </span><br><span class="line">        mov es:[160*12+40*2+2],al</span><br><span class="line"></span><br><span class="line">        pop es</span><br><span class="line">        pop bx</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line">16.4 程序入口地址的直接定址表</span><br><span class="line">    【编程】实现一个子程序setscreen，为显示输出提供如下功能：</span><br><span class="line">        1.清屏</span><br><span class="line">        2.设置前景色</span><br><span class="line">        3.设置背景色</span><br><span class="line">        4.向上滚动一行</span><br><span class="line">    1.入口参数说明：</span><br><span class="line">        1.用ah寄存器传递功能号</span><br><span class="line">            0：清屏；1：设置前景色；2：设置背景色；3：向上滚动一行</span><br><span class="line">        2.对于2、3号功能，用al传递颜色值</span><br><span class="line">            al∈&#123;0，1，2，3，4，5，6，7&#125;</span><br><span class="line">    2.各种功能如何实现</span><br><span class="line">        1.清屏：</span><br><span class="line">            将显存中当前屏幕中的字符设为空格符；</span><br><span class="line">        2.设置前景色：</span><br><span class="line">            设置显存中当前屏幕中处于奇地址的属性字节的第0、1、2位；</span><br><span class="line">            012位存放前景色</span><br><span class="line">        3.设置背景色：</span><br><span class="line">            设置显存中当前屏幕中处于奇地址的属性字节的第4、5、6位；</span><br><span class="line">            456位存放背景色</span><br><span class="line">        4.向上滚动一行：</span><br><span class="line">            依次将第 n+1行的内容复制到第n行处：最后一行为空。  </span><br><span class="line">;功能子程序1：清屏</span><br><span class="line">sub1:      push bx      ;保护现场,调用子程序的时候，注意要保护现场，运行子程序的时候，可能会修改一些寄存器的值</span><br><span class="line">        push cx</span><br><span class="line">        push es</span><br><span class="line">        mov bx,0b800h</span><br><span class="line">        mov es,bx</span><br><span class="line">        mov bx,0</span><br><span class="line">        mov cx,2000</span><br><span class="line">sub1s:    mov byte ptr es:[bx],&#x27; &#x27;  ;循坏2000次</span><br><span class="line">        add bx,2</span><br><span class="line">        loop sub1s</span><br><span class="line">        pop es          ;</span><br><span class="line">        pop cx</span><br><span class="line">        pop bx</span><br><span class="line">        ret 	</span><br><span class="line">;功能子程序2：设置前景</span><br><span class="line">sub2:	push bx</span><br><span class="line">	push cx</span><br><span class="line">	push es</span><br><span class="line">	mov bx,0b800h</span><br><span class="line">	mov es,bx</span><br><span class="line">	mov bx,1</span><br><span class="line">	mov cx,2000</span><br><span class="line">sub2s:	and byte ptr es:[bx],11111000b	</span><br><span class="line">	or es:[bx],al </span><br><span class="line">	add bx,2</span><br><span class="line">	loop sub2s</span><br><span class="line"></span><br><span class="line">	pop es</span><br><span class="line">	pop cx</span><br><span class="line">	pop bx</span><br><span class="line">	ret		</span><br><span class="line">;功能子程序3：设置背景色</span><br><span class="line">sub3:	push bx</span><br><span class="line">	push cx</span><br><span class="line">	push es</span><br><span class="line">	mov cl,4</span><br><span class="line">	shl al,cl</span><br><span class="line">	mov bx,0b800h</span><br><span class="line">	mov es,bx</span><br><span class="line">	mov bx,1</span><br><span class="line">	mov cx,2000</span><br><span class="line">sub3s:	and byte ptr es:[bx],10001111b</span><br><span class="line">	or es:[bx],al </span><br><span class="line">	add bx,2</span><br><span class="line">	loop sub2s</span><br><span class="line"></span><br><span class="line">	pop es</span><br><span class="line">	pop cx</span><br><span class="line">	pop bx</span><br><span class="line">	ret </span><br><span class="line">;功能子程序4：向上滚动一行</span><br><span class="line">sub4:	</span><br><span class="line">	push cx</span><br><span class="line">	push si</span><br><span class="line">	push di</span><br><span class="line">	push es</span><br><span class="line">	push ds</span><br><span class="line"></span><br><span class="line">	mov si,0b800h</span><br><span class="line">	mov es,si</span><br><span class="line">	mov ds,si</span><br><span class="line">	mov si,160			;ds:si指向第n+1行，第1行</span><br><span class="line">	mov di,0			;es:di指向第n行，第0行</span><br><span class="line">	cld</span><br><span class="line">	mov cx,24;共复制24行</span><br><span class="line"></span><br><span class="line">sub4s:	</span><br><span class="line">	push cx</span><br><span class="line">	mov cx,160</span><br><span class="line">	rep movsb 			;复制</span><br><span class="line">  	pop cx</span><br><span class="line">	loop sub4s</span><br><span class="line"></span><br><span class="line">	mov cx,80	</span><br><span class="line">	mov si,0</span><br><span class="line">	</span><br><span class="line">sub4s1: </span><br><span class="line">	mov byte ptr es:[160*24+si],&#x27; &#x27;		;最后一行清空</span><br><span class="line">	add si,2</span><br><span class="line">	loop sub4s1</span><br><span class="line"></span><br><span class="line">	pop ds</span><br><span class="line">	pop es</span><br><span class="line">	pop di</span><br><span class="line">	pop si</span><br><span class="line">	pop cx</span><br><span class="line">	ret ;sub4 ends</span><br><span class="line">3.可以将这些功能子程序的入口地址存储在一个表中，他们在表中的位置和功能号相对应</span><br><span class="line">;编程：实现一个子程序setscreen，为显示输出提供如下功能：</span><br><span class="line">;(1) 清屏。</span><br><span class="line">;(2) 设置前景色。</span><br><span class="line">;(3) 设置背景色。</span><br><span class="line">;(4) 向上滚动一行。</span><br><span class="line">;</span><br><span class="line">;入口参数说明：</span><br><span class="line">;(1) 用 ah 寄存器传递功能号：0 表示清屏，1表示设置前景色，2 表示设置背景色，3 表示向上滚动一行；</span><br><span class="line">;(2) 对于2、3号功能，用 al 传送颜色值，(al) ∈&#123;0,1,2,3,4,5,6,7&#125;</span><br><span class="line"></span><br><span class="line">setscreen: jmp short set</span><br><span class="line"></span><br><span class="line">    table  dw sub1,sub2,sub3,sub4</span><br><span class="line">set:	</span><br><span class="line">	push bx	</span><br><span class="line">	cmp ah,3		;判断传递的是否大于 3</span><br><span class="line">	ja sret</span><br><span class="line">	mov bl,ah</span><br><span class="line">	mov bh,0</span><br><span class="line">	add bx,bx		;根据ah中的功能号计算对应子程序的地址在table表中的偏移</span><br><span class="line">	</span><br><span class="line">	call word ptr table[bx]	;调用对应的功能子程序，学会本句代码，是本章节的【精髓】</span><br><span class="line"></span><br><span class="line">sret:	</span><br><span class="line">	pop bx	</span><br><span class="line">	iret</span><br><span class="line"></span><br><span class="line">;功能子程序1：清屏</span><br><span class="line">sub1:   </span><br><span class="line">	push bx</span><br><span class="line">	push cx</span><br><span class="line">    push es</span><br><span class="line">	mov bx,0b800h</span><br><span class="line">	mov es,bx</span><br><span class="line">	mov bx,0</span><br><span class="line">	mov cx,2000</span><br><span class="line">	</span><br><span class="line">sub1s:  </span><br><span class="line">	mov byte ptr es:[bx],&#x27; &#x27;</span><br><span class="line">    add bx,2</span><br><span class="line">    loop sub1s</span><br><span class="line">    pop es</span><br><span class="line">    pop cx</span><br><span class="line">    pop bx</span><br><span class="line">	ret ;sub1 ends</span><br><span class="line"></span><br><span class="line">;功能子程序2：设置前景色</span><br><span class="line">sub2:	</span><br><span class="line">	push bx</span><br><span class="line">	push cx</span><br><span class="line">	push es</span><br><span class="line">	mov bx,0b800h</span><br><span class="line">	mov es,bx</span><br><span class="line">	mov bx,1</span><br><span class="line">	mov cx,2000</span><br><span class="line">	</span><br><span class="line">sub2s:	</span><br><span class="line">	and byte ptr es:[bx],11111000b	</span><br><span class="line">	or es:[bx],al </span><br><span class="line">	add bx,2</span><br><span class="line">	loop sub2s</span><br><span class="line"></span><br><span class="line">	pop es</span><br><span class="line">	pop cx</span><br><span class="line">	pop bx</span><br><span class="line">	ret ;sub2 ends</span><br><span class="line"></span><br><span class="line">;功能子程序3：设置背景色</span><br><span class="line">sub3:	</span><br><span class="line">	push bx</span><br><span class="line">	push cx</span><br><span class="line">	push es</span><br><span class="line">	mov cl,4</span><br><span class="line">	shl al,cl</span><br><span class="line">	mov bx,0b800h</span><br><span class="line">	mov es,bx</span><br><span class="line">	mov bx,1</span><br><span class="line">	mov cx,2000</span><br><span class="line">	</span><br><span class="line">sub3s:	</span><br><span class="line">	and byte ptr es:[bx],10001111b</span><br><span class="line">	or es:[bx],al </span><br><span class="line">	add bx,2</span><br><span class="line">	loop sub2s</span><br><span class="line"></span><br><span class="line">	pop es</span><br><span class="line">	pop cx</span><br><span class="line">	pop bx</span><br><span class="line">	ret ; sub3 ends</span><br><span class="line"></span><br><span class="line">;功能子程序4：向上滚动一行</span><br><span class="line">sub4:	</span><br><span class="line">	push cx</span><br><span class="line">	push si</span><br><span class="line">	push di</span><br><span class="line">	push es</span><br><span class="line">	push ds</span><br><span class="line"></span><br><span class="line">	mov si,0b800h</span><br><span class="line">	mov es,si</span><br><span class="line">	mov ds,si</span><br><span class="line">	mov si,160			;ds:si指向第n+1行</span><br><span class="line">	mov di,0			;es:di指向第n行</span><br><span class="line">	cld</span><br><span class="line">	mov cx,24;共复制24行</span><br><span class="line"></span><br><span class="line">sub4s:	</span><br><span class="line">	push cx</span><br><span class="line">	mov cx,160</span><br><span class="line">	rep movsb 			;复制</span><br><span class="line">  	pop cx</span><br><span class="line">	loop sub4s</span><br><span class="line"></span><br><span class="line">	mov cx,80	</span><br><span class="line">	mov si,0</span><br><span class="line">	</span><br><span class="line">sub4s1: </span><br><span class="line">	mov byte ptr es:[160*24+si],&#x27; &#x27;		;最后一行清空</span><br><span class="line">	add si,2</span><br><span class="line">	loop sub4s1</span><br><span class="line"></span><br><span class="line">	pop ds</span><br><span class="line">	pop es</span><br><span class="line">	pop di</span><br><span class="line">	pop si</span><br><span class="line">	pop cx</span><br><span class="line">	ret ;sub4 ends</span><br></pre></td></tr></table></figure>
<h2 id="第十七章-使用BIOS进入键盘输入和磁盘读写"><a href="#第十七章-使用BIOS进入键盘输入和磁盘读写" class="headerlink" title="第十七章 使用BIOS进入键盘输入和磁盘读写"></a>第十七章 使用BIOS进入键盘输入和磁盘读写</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">**引言</span><br><span class="line">    1.大多数有用的程序都需要处理用户的输入，键盘输入是最基本的输入。</span><br><span class="line">    2.程序和数据通常需要长期存储，磁盘是最常用的存储设备。</span><br><span class="line">    3.BIOS 为这两种外设的I/O提供了最基本的中断例程，在本章中，我们对它们的应用和相关的问题进行讨论。</span><br><span class="line">17.1 int9中断例程对键盘输入的处理</span><br><span class="line">    CPU 在9 号中断发生后，执行int 9中断例程，从60h 端口读出扫描码，</span><br><span class="line">        并将其转化为相应的ASCII 码或状态信息，存储在内存的指定空间（键盘缓冲区或状态字节）中。</span><br><span class="line">17.2 使用int16h中断例程读取键盘缓冲区</span><br><span class="line">    1.BIOS提供了int 16h 中断例程供程序员调用。</span><br><span class="line">    2.int 16h 中断例程中包含的一个最重要的功能是从键盘缓冲区中读取一个键盘输入，该功能的编号为0。</span><br><span class="line">    3.下面的指令从键盘缓冲区（缓冲区的最低位）中读取一个键盘输入，并且将其从缓冲区中删除：</span><br><span class="line">           mov ah,0</span><br><span class="line">           int 16h</span><br><span class="line">      结果：(ah)=扫描码，(al)=ASCII码。</span><br><span class="line">    4.int 16h 中断例程的 0 号功能，进行如下的工作：</span><br><span class="line">        （1）检测键盘缓冲区中是否有数据；</span><br><span class="line">        （2）没有则继续做第1 步；（缓冲区随时有可能输入数据）</span><br><span class="line">        （3）读取缓冲区第一个字单元中的键盘输入；</span><br><span class="line">        （4）将读取的扫描码送入ah，ASCII 码送入al；</span><br><span class="line">        （5）将己读取的键盘输入从缓冲区中删除。</span><br><span class="line">    5.可见，B1OS 的int 9 中断例程和int 16h 中断例程是一对相互配合的程序，</span><br><span class="line">        int 9 中断例程向键盘缓冲区中写入，</span><br><span class="line">        int 16h 中断例程从缓冲区中读出。</span><br><span class="line">      它们写入和读出的时机不同，int 9 中断例程在有键按下的时候向键盘缓冲区中写入数据；</span><br><span class="line">      而int 16h 中断例程是在应用程序对其进行调用的时候，将数据从键盘缓冲区中读出。</span><br><span class="line">    【编程】接收用户的键盘输入，输入“r”，将屏幕上的字符设置为红色：输入“g”， </span><br><span class="line">        将屏幕上的字符设置为绿色；输入“b ”，将屏幕上的字符设置为蓝色。</span><br><span class="line">;编程：</span><br><span class="line">;接收用户的键盘输入，输入“r”，将屏幕上的字符设置为红色：输入“g”， </span><br><span class="line">;将屏幕上的字符设置为绿色；输入“b ”，将屏幕上的字符设置为蓝色。</span><br><span class="line">;A、B、C处的程序指令比较有技巧，请读者自行分析</span><br><span class="line">code segment</span><br><span class="line">    assume cs:code</span><br><span class="line">start:	</span><br><span class="line">	mov ah,0</span><br><span class="line">	int 16h				;int 16h 0号功能实现从键盘缓冲区读取一个键盘输入</span><br><span class="line">		</span><br><span class="line">	mov ah,1			;A</span><br><span class="line">	cmp al,&#x27;r&#x27;</span><br><span class="line">	je red</span><br><span class="line">	cmp al,&#x27;g&#x27;</span><br><span class="line">	je green</span><br><span class="line">	cmp al,&#x27;b&#x27;</span><br><span class="line">	je blue</span><br><span class="line">	jmp short sret</span><br><span class="line">	</span><br><span class="line">red:	</span><br><span class="line">	shl ah,1			;B</span><br><span class="line">green:	</span><br><span class="line">	shl ah,1			;C</span><br><span class="line"></span><br><span class="line">blue:	</span><br><span class="line">	mov bx,0b800h</span><br><span class="line">	mov es,bx</span><br><span class="line">	mov bx,1</span><br><span class="line">	mov cx,2000</span><br><span class="line">s:	and byte ptr es:[bx],11111000b      ;设置颜色</span><br><span class="line">	or es:[bx],ah                       ;设置颜色</span><br><span class="line">	add bx,2</span><br><span class="line">	loop s</span><br><span class="line"></span><br><span class="line">sret:	</span><br><span class="line">	mov ax,4c00h</span><br><span class="line">	int 21h</span><br><span class="line">	</span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line">17.3 字符串的输入</span><br><span class="line">    int 21h的0a号功能可以实现字符串的输入</span><br><span class="line">    也可以用int 16h，通过显示键盘缓冲区中的内容，实现字符串的显示</span><br><span class="line">    1.使用int 16h显示字符串程序的处理过程如下</span><br><span class="line">        ① 调用int 16h读取键盘输入；</span><br><span class="line">        ② 如果是字符，进入字符栈，显示字符栈中的所有字符；继续执行① ；</span><br><span class="line">        ③ 如果是退格键，从字符栈中弹出一个字符，显示字符栈中的所有字符；继续执行① ；</span><br><span class="line">        ④ 如果是Enter 键，向字符栈中压入0，返回。</span><br><span class="line">    2.子程序：字符栈的入栈、出栈和显示</span><br><span class="line">        参数说明</span><br><span class="line">        (ah)=功能号，0表示入栈，1表示出栈，2表示显示；</span><br><span class="line">            ds : si 指向字符栈空间；</span><br><span class="line">        对于0 号功能：(al)=入栈字符；</span><br><span class="line">        对于1 号功能：(al)=返回的字符；</span><br><span class="line">        对于2 号功能：(dh)、(dl) =字符串在屏幕上显示的行、列位置。</span><br><span class="line">;使用int 16h显示字符串的子程序：字符栈</span><br><span class="line">;最基本的字符串输入程序，需要具备下面的功能：</span><br><span class="line">;（1） 在输入的同时需要显示这个字符串；</span><br><span class="line">;（2）一般在输入回车符后，字符串输入结束；</span><br><span class="line">;（3）能够删除已经输入的字符。</span><br><span class="line"></span><br><span class="line">;编写一个接收字符串的输入子程序，实现上面三个基本功能。</span><br><span class="line">;因为在输入的过程中需要显示，子程序的参数如下：</span><br><span class="line">;	(dh)、(dl)=字符串在屏幕上显示的行、列位置；</span><br><span class="line">;	ds:si 指向字符串的存储空间，字符串以O 为结尾符。</span><br><span class="line"></span><br><span class="line">;功能子程序实现</span><br><span class="line"></span><br><span class="line">charstack:</span><br><span class="line">	jmp short charstart</span><br><span class="line">	</span><br><span class="line">	table dw charpush,charpop,charshow</span><br><span class="line">	top dw 0   							;栈顶</span><br><span class="line">   </span><br><span class="line">charstart:</span><br><span class="line">	push bx</span><br><span class="line">	push dx</span><br><span class="line">	push di</span><br><span class="line">	push es</span><br><span class="line"></span><br><span class="line">	cmp ah,2</span><br><span class="line">	ja sret</span><br><span class="line">	mov bl,ah</span><br><span class="line">	mov bh,0</span><br><span class="line">	add bx,bx</span><br><span class="line">	jmp word ptr table[bx]      ;使用直接定址表</span><br><span class="line"></span><br><span class="line">charpush:</span><br><span class="line">	mov bx,top</span><br><span class="line">	mov [si][bx],al</span><br><span class="line">	inc top</span><br><span class="line">	jmp sret</span><br><span class="line"></span><br><span class="line">charpop:</span><br><span class="line">	cmp top,0</span><br><span class="line">	je sret</span><br><span class="line">	dec top</span><br><span class="line">	mov bx,top</span><br><span class="line">	mov al,[si][bx]	</span><br><span class="line">	jmp sret</span><br><span class="line"></span><br><span class="line">charshow:</span><br><span class="line">	mov bx,0b800h</span><br><span class="line">	mov es,bx</span><br><span class="line">	mov al,160</span><br><span class="line">	mov ah,0	</span><br><span class="line">	mul dh</span><br><span class="line">	mov di,ax</span><br><span class="line">	add dl,dl</span><br><span class="line">	mov dh,0</span><br><span class="line">	add di,dx</span><br><span class="line"></span><br><span class="line">	mov bx,0</span><br><span class="line"></span><br><span class="line">charshows:</span><br><span class="line">	cmp bx,top</span><br><span class="line">	jne noempty</span><br><span class="line">	mov byte ptr es:[di],&#x27; &#x27;	</span><br><span class="line">	jmp sret</span><br><span class="line"></span><br><span class="line">noempty:</span><br><span class="line">	mov al,[si][bx]</span><br><span class="line">	mov es:[di],al</span><br><span class="line">	mov byte ptr es:[di+2],&#x27; &#x27;</span><br><span class="line">	inc bx</span><br><span class="line">	add di,2</span><br><span class="line">	jmp charshows</span><br><span class="line"></span><br><span class="line">sret:	</span><br><span class="line">	pop es</span><br><span class="line">	pop di</span><br><span class="line">	pop dx</span><br><span class="line">	pop bx</span><br><span class="line">	ret</span><br><span class="line">17.4 应用int13h中断例程对键盘进行读写</span><br><span class="line">    1.磁盘的实际访问由磁盘控制器进行，我们可以通过控制磁盘控制器来访问磁盘。</span><br><span class="line">    2.注意，我们只能以扇区为单位对磁盘进行读写。</span><br><span class="line">      在读写扇区的时候，要给出面号、磁道号和扇区号。面号和磁道号从0开始，而扇区号从1开始。</span><br><span class="line">    3.BIOS提供了对扇区进行读写的中断例程，这些中断例程完成了许多复杂的和硬件相关的工作。</span><br><span class="line">    4.我们可以通过调用BIOS中断例程来访问磁盘。</span><br><span class="line">        BIOS 提供的访问磁盘的中断例程为int 13h 。</span><br><span class="line">      如下，读取0面0道1扇区的内容到0:200： </span><br></pre></td></tr></table></figure>
<p><img src="17.1.png" alt="avatar"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  返回参数：</span><br><span class="line">      操作成功：（ah）=0，（al）=读入的扇区数</span><br><span class="line">      操作失败：（ah）=出错代码</span><br><span class="line">将0:200中的内容写入0面0道1扇区示例</span><br><span class="line">  返回参数：</span><br></pre></td></tr></table></figure>
<p><img src="17.2.png" alt="avatar"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">        操作成功： (ah)=0，(al)=写入的扇区数</span><br><span class="line">        操作失败： (ah)=出错代码</span><br><span class="line">5.注意：使用int 13h 中断例程对软盘进行读写。直接向磁盘扇区写入数据是很危险的，</span><br><span class="line">   很可能覆盖掉重要的数据。</span><br><span class="line">【编程】将当前屏幕的内容保存在磁盘上</span><br><span class="line">    分析：1 屏的内容占4000个字节，需要8 个扇区（一个扇区512B），我们用0面0道的1~8扇区存储显存中的内容。</span><br><span class="line">code segment</span><br><span class="line">    assume cs:code</span><br><span class="line">start:	</span><br><span class="line">	mov ax,0b800h</span><br><span class="line">	mov es,ax</span><br><span class="line">	mov bx,0	;es:bx	指向将写入磁盘的数据的内存区</span><br><span class="line"></span><br><span class="line">	mov al,8 	;写入的扇区数</span><br><span class="line">	mov ch,0 	;磁道号，从0开始</span><br><span class="line">	mov cl,1 	;扇区号 从1开始</span><br><span class="line">	mov dl,0 	;驱动器号0:软驱A,  1:软驱B,硬盘从80h开始， 80h:硬盘C，81h:硬盘D</span><br><span class="line">	mov dh,0 	;磁头号，（对于软盘即面号，因为一个面用一个磁头来读写）</span><br><span class="line">	mov ah,3	;传递 int 13h 写入数据的功能号</span><br><span class="line">	int 13h</span><br><span class="line"></span><br><span class="line">			;返回参数</span><br><span class="line">			;操作成功:(ah) = 0,(al) = 写入的扇区数</span><br><span class="line">			;操作失败:(ah) = 出错代码</span><br><span class="line">	</span><br><span class="line">return:	</span><br><span class="line">	mov ax,4c00h</span><br><span class="line">	int 21h</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>

    
  </div>

  
  <!-- Post Copyright -->

    

  

  
  <footer class="post-footer">
    
    <div class="post-tags">
      
      <a href="/tags/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/">汇编语言</a>
      
    </div>
    
      
  <nav class="post-nav">  
      
      <a class="prev" href="/2022/01/18/%E4%B9%A6%E5%8D%95%E8%AE%B0%E5%BD%95/">  
        <i class="iconfont icon-left"></i>  
        <span class="prev-text nav-default">书单记录</span>  
        <span class="prev-text nav-mobile">上一篇</span>  
      </a>  
      
      
      <a class="next" href="/2022/01/16/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E4%BA%8C/">  
        <span class="next-text nav-default">汇编语言二</span>  
        <span class="prev-text nav-mobile">下一篇</span>  
        <i class="iconfont icon-right"></i>  
      </a>  
      
  </nav>  
  

  </footer>
  

</article>
        </div>
          
  <div class="comments" id="comments">  
      
      <div id="gitalk-container"></div>  
      
  </div>  
  

      </div>
    </main>
    <footer id="footer" class="footer">
      <!-- Social Links -->

<div class="social-links">
  
  
  
  
  <a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <a target="_blank" rel="noopener" href="https://github.com/fengxuegt" class="iconfont icon-github" title="github"></a>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  

  
  
  <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
  
</div>



<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 -
    <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/zeed-w-beez/hexo-theme-even">Even</a>
  </span>
  <span class="division">|</span>
  <span class="hosting-info">
    footer.hosting
  </span>

  <span class="copyright-year">
    <span>
      
      &copy;
      
      2021 - 2025      
    </span>

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>

    <span class="author">枫雪</span>
  </span>

</div>
    </footer>
    <div class="back-to-top" id="back-to-top"> <i class="iconfont icon-up"></i> </div>
  </div>
    
    
    
    
  

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css" />


<script src="//cdn.jsdelivr.net/npm/js-md5@0.7.3/src/md5.min.js"></script>

<script>
  var gitalk = new Gitalk({
    clientID: 'Ov23linyjoE7z3V3Gako',
    clientSecret: '4bbd23045cfc104a6cf9f988ca2051cf86f1b25b',
    repo: 'blog-review',
    owner: 'fengxuegt',
    admin: ['fengxuegt'],
    id: md5(location.pathname),
    
    language: '',
    
    distractionFreeMode: 'true'
  });
  gitalk.render('gitalk-container');
</script>

  
    
    
  

  







<script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>



<script type="text/javascript" src="/lib/slideout/slideout.js"></script>



<script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>



  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>

</html>